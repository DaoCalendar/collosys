<style type="text/css">
    .modal-huge {
        width: 80%;
        margin-left: -40%;
    }

    .errorbg {
        background-color: coral;
    }

    .donebg {
        background-color: lightgreen;
    }

    .inprocessbg {
        background-color: khaki;
    }

    .postprocessbg {
        background-color: lightblue;
    }
</style>

<div class="form-horizontal">
    <div class="row">
        <div class="control-group">
            <label class="control-label">Date Range</label>
                <div class="input-append">
                    <input class="input-medium" type="text" data-ng-model="fileScheduler.fromDate" data-bs-datepicker="" />
                    <button type="button" class="btn" data-toggle="datepicker"><i class="icon-calendar"></i></button>
                </div>
                <div class="input-append">
                    <input type="text" class="input-medium" data-ng-model="fileScheduler.toDate" bs-datepicker />
                    <button type="button" class="btn" data-toggle="datepicker"><i class="icon-calendar"></i></button>
                </div>
                <button class="btn btn-success" data-ng-click="getCurrentStatus()">OK</button>
        </div>
    </div>
</div>

<div class="row-fluid">
    <!-- update counter -->
    <div class="row-fluid text-left alert alert-success" style="margin: 0; padding: 0">
        <div data-ng-show="doUpdate">
            <span>Refreshing upload status from DB!!!</span>
        </div>
        <div data-ng-hide="doUpdate">
            <button class="btn btn-link" data-ng-click="toggleAutoRefresh()">{{autoRefreshText}}</button>
            <span>...Refreshing upload status in {{updatingInSeconds}} seconds</span>
        </div>
    </div>

    <!-- status display -->
    <div class="row-fluid">
        <div class="span12" style="overflow: auto; margin: 0; padding: 0; height: 450px; width: 100%">
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th colspan="2">Actions</th>
                        <th>Systems</th>
                        <th>Category</th>
                        <th>File Name</th>
                        <th>Total Rows</th>
                        <th>Valid Rows</th>
                        <th>File Date</th>
                        <th>Upload Status</th>
                        <th>Status Description</th>
                        <th>File Size</th>
                        <th>Requested On</th>
                        <th>Upload Done On</th>
                        <th>Immediate</th>
                        <th>Immediate Reason</th>
                    </tr>
                    <tr>
                        <th colspan="2"></th>
                        <th>
                            <input type="text" data-ng-model="search.ScbSystems" style="width: 70px" />
                        </th>
                        <th>
                            <input type="text" data-ng-model="search.Category" style="width: 70px" />
                        </th>
                        <th>
                            <input type="text" data-ng-model="search.FileName" style="width: 220px" />
                        </th>
                        <th>
                            <input type="text" data-ng-model="search.TotalRows" style="width: 70px" />
                        </th>
                        <th>
                            <input type="text" data-ng-model="search.ValidRows" style="width: 70px" />
                        </th>
                        <th>
                            <input type="text" data-ng-model="search.FileDate" style="width: 70px" />
                        </th>
                        <th>
                            <input type="text" data-ng-model="search.UploadStatus" style="width: 120px" />
                        </th>
                        <th>
                            <input type="text" data-ng-model="search.StatusDescription" style="width: 120px" />
                        </th>
                        <th>
                            <input type="text" data-ng-model="search.FileSize" style="width: 70px" />
                        </th>
                        <th>
                            <input type="text" data-ng-model="search.StartDateTime" style="width: 120px" />
                        </th>
                        <th>
                            <input type="text" data-ng-model="search.EndDateTime" style="width: 120px" />
                        </th>
                        <th>
                            <input type="text" data-ng-model="search.IsImmediate" style="width: 50px" />
                        </th>
                        <th>
                            <input type="text" data-ng-model="search.ImmediateReason" style="width: 120px" />
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr data-ng-repeat="fileScheduler in fileSchedulers | filter:search"
                        data-ng-class="{errorbg: fileScheduler.UploadStatus == 'Error', inprocessbg: fileScheduler.UploadStatus == 'UploadStarted', donebg: fileScheduler.UploadStatus == 'Done' || fileScheduler.UploadStatus == 'DoneWithError',postprocessbg: fileScheduler.UploadStatus == 'PostProcessing'}">
                        <td>
                            <button class="btn btn-link" data-ng-show="{{fileScheduler.UploadStatus=='Error'}}" data-ng-click="showDeleteModelPopup(fileScheduler,$index)" type="button">Delete</button>
                            <button class="btn btn-link" data-ng-show="{{fileScheduler.UploadStatus=='Done' || fileScheduler.UploadStatus=='DoneWithError'}}" data-ng-click="downloadFile(fileScheduler)" type="button">Download</button>
                            <button class="btn btn-link" data-ng-show="{{fileScheduler.UploadStatus=='UploadRequest' && fileScheduler.IsImmediate != true }}" data-ng-click="modelImmediateOpen(fileScheduler,$index)" type="button">Immediate</button>
                        </td>
                        <td>
                            <button class="btn btn-link" data-ng-show="{{fileScheduler.UploadStatus=='Error'}}" data-ng-click="retryFileUpload(fileScheduler, $index)" type="button">Retry</button>
                            <button class="btn btn-link" data-ng-show="{{fileScheduler.UploadStatus!='UploadRequest' && fileScheduler.UploadStatus!='Error' && fileScheduler.UploadStatus!='RetryUpload' }}" data-ng-click="openModelData(fileScheduler)" type="button">Status</button>
                        </td>
                        <td>{{fileScheduler.ScbSystems}}</td>
                        <td>{{fileScheduler.Category}}</td>
                        <td>
                            <button class="btn btn-link" data-ng-click="downloadInputFile(fileScheduler)" type="button">{{fileScheduler.FileNameDisplay}}</button>
                        </td>
                        <td>{{fileScheduler.TotalRows}}</td>
                        <td>{{fileScheduler.ValidRows}}</td>
                        <td>{{fileScheduler.FileDate | date:'yyyy-MM-dd'}}</td>
                        <td>{{fileScheduler.UploadStatus}}</td>
                        <td>{{fileScheduler.StatusDescription}}</td>
                        <td>{{fileScheduler.FileSize | bytes}}</td>
                        <td>{{fileScheduler.StartDateTime | date:'yyyy-MM-dd HH:mm:ss'}}</td>
                        <td>{{fileScheduler.EndDateTime | date:'yyyy-MM-dd HH:mm:ss'}}</td>
                        <td>{{fileScheduler.IsImmediate}} </td>
                        <td>{{fileScheduler.ImmediateReason}}</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- modal popup for file status array -->
        <div>
            <div modal="shouldBeOpen" close="closeModel()" options="modelOption">
                <div class="modal-header well" style="text-align: center">
                    <h3>Upload Status</h3>
                </div>

                <div class="modal-body">
                    <div class="form-horizontal row-fluid">
                        <div class="control-group span3">
                            <label class="control-label">Systems</label>
                            <div class="controls">
                                <input type="text" class="input-small" disabled="disabled" data-ng-model="modalFileScheduler.ScbSystems" />
                            </div>
                        </div>
                        <div class="control-group span3">
                            <label class="control-label">Category</label>
                            <div class="controls">
                                <input type="text" class="input-small" disabled="disabled" data-ng-model="modalFileScheduler.Category" />
                            </div>
                        </div>
                        <div class="control-group span4">
                            <label class="control-label">File Name</label>
                            <div class="controls">
                                <input type="text" class="input-large" disabled="disabled" data-ng-model="modalFileScheduler.FileNameDisplay" />
                            </div>
                        </div>
                    </div>
                    <table class="table table-bordered table-hover">
                        <thead>
                            <tr>
                                <th>Total Rows</th>
                                <th>Uploaded Rows</th>
                                <th>Valid Rows</th>
                                <th>Duplicate Rows</th>
                                <th>Error Rows</th>
                                <th>Ignored Rows</th>
                                <th>Upload Status</th>
                                <th>Entry Time</th>
                                <th>Time Gap</th>
                                <!-- <th>Total Time</th> -->
                            </tr>
                        </thead>
                        <tbody>
                            <tr data-ng-repeat="status in modalFileScheduler.FileStatuss | orderBy : 'EntryDateTime'">
                                <td>{{status.TotalRows}}</td>
                                <td>{{status.UploadedRows}}</td>
                                <td>{{status.ValidRows}}</td>
                                <td>{{status.DuplicateRows}}</td>
                                <td>{{status.ErrorRows}}</td>
                                <td>{{status.IgnoredRows}}</td>
                                <td>{{status.UploadStatus}}</td>
                                <td>{{status.EntryDateTime | date:'yyyy-MM-dd HH:mm:ss'}}</td>
                                <td>{{CompuateTimeSpent($index)}}</td>
                                <!--<td>{{CompuateTotalTimeSpent($index)}}</td>-->
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="modal-footer well">
                    <button class="btn btn-warning" data-ng-click="closeModel()"><i class="icon-off" style="color: red"></i>Close</button>
                </div>
            </div>
        </div>

        <!-- modal popup for immediate reason -->
        <div>
            <div modal="openImidiateModel" options="imidiateModelOption">
                <data-ng-form name="immidiateform">
                    <div class="modal-header well" style="text-align: center">
                        <h3>Immediate Reason</h3>
                    </div>

                    <div class="modal-body" style="text-align: center">
                        <textarea rows="4" cols="20" data-ng-model="ImmediatefileScheduler.ImmediateReason" required></textarea>
                    </div>
                    <div class="modal-footer well">
                        <button class="btn btn-primary" data-ng-disabled="immidiateform.$invalid" data-ng-click="rescheduleFile(ImmediatefileScheduler)">Reschedule</button>
                        <button class="btn btn-warning" data-ng-click="closeImidiateModel(ImmediatefileScheduler)">Cancel</button>
                    </div>
                </data-ng-form>
            </div>
        </div>

        <!-- modal popup for delete -->
        <div modal="showDeleteModel" close="noToDelete()" options="{keyboard: false, backdropClick: false}">
            <div class="modal-header">
                Confirmation
            </div>
            <div class="modal-body">
                Are you sure to you want to DELETE?
            </div>
            <div class="modal-footer">
                <input type="button" value="Yes" class="btn btn-danger" data-ng-click="deleteUpload()" />
                <input type="button" value="No" class="btn btn-success" data-ng-click="noToDelete()" />
            </div>
        </div>
    </div>
</div>
