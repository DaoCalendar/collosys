@{
    ViewBag.Title = "ViewStakeholder";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid" data-ng-controller="viewStake">

    <div class="row-fluid">
        <div class="row-fluid">
            <button class="btn btn-success" data-ng-show="CurrUserInfo.Permission=='Approve'||CurrUserInfo.Permission=='Modify'" data-ng-click="addStakeholder()">Add New</button>
        </div>
        <div class="panel form-horizontal">
            <div class="panel-heading">
                View Stakeholders
            </div>

            <div class="row-fluid">
                <div class="control-group span3"  @*data-ng-show="stakeholder.Designation"*@>
                    <label class="control-label">View</label>
                    <div class="controls">
                        <select class="input-medium" data-ng-model="stakeholder.filter"
                            data-ui-select2=""
                            data-ng-change="setPageNumber();stakeholder.Hierarchy='';changeHierarchylist();getStakeData(stakeholder)"
                            data-ng-click="">
                            <option></option>
                            <option data-ng-repeat="data in filters">{{data}}</option>
                        </select>
                    </div>
                </div>
                <div data-ng-show="checkFilter(stakeholder.filter)">
                    <div class="control-group span3">
                        <label class="control-label">Hierarchy</label>
                        <div class="controls">
                            <div data-ng-show="stakeholder.filter!='ReportingTo'">
                                <select data-ui-select2="" class="input-medium"
                                    data-ng-model="stakeholder.Hierarchy" data-ng-change="changeHierarchylist()">
                                    <option></option>
                                    <option data-ng-repeat="data in hierarchyDesignation|unique:'Hierarchy'">{{data.Hierarchy}}</option>
                                </select>
                            </div>
                            <div data-ng-show="stakeholder.filter==='ReportingTo'">
                                <select data-ui-select2=""
                                    data-ng-show="stakeholder.filter==='ReportingTo'"
                                    class="input-medium" data-ng-model="stakeholder.Hierarchy" data-ng-change="changeHierarchylist()">
                                    <option></option>
                                    <option>External</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div data-ng-show="stakeholder.Hierarchy && stakeholder.filter!='ReportingTo'">
                        <div class="control-group span3">
                            <label class="control-label">Designation</label>
                            <div class="controls">
                                <select data-ui-select2="" class="input-medium" data-ng-model="stakeholder.Designation" data-ng-change="startCount=0;getStakeData(stakeholder); setHierarchy(data); updateScreen()">
                                    <option></option>
                                    <option data-ng-repeat="data in hierarchyDesignation|filter:{'Hierarchy':stakeholder.Hierarchy}|orderBy:'PositionLevel'"
                                        value="{{data.Id}}">{{getHierarchyDisplayName(data)}}</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div data-ng-show="stakeholder.Hierarchy && stakeholder.filter==='ReportingTo'">
                        <div class="control-group span3">
                            <label class="control-label">Designation</label>
                            <div class="controls">
                                <select data-ui-select2="" class="input-medium" data-ng-model="stakeholder.Designation" data-ng-change="startCount=0;getStakeData(stakeholder); setHierarchy(data);reportsToStakeholder=''; updateScreen()">
                                    <option></option>
                                    <option data-ng-repeat="data in hierarchyDesignation|filter:{'Hierarchy':stakeholder.Hierarchy}|filter:{'IsIndividual':'false'}|orderBy:'PositionLevel'"
                                        value="{{data.Id}}">{{data.Designation}}</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="control-group span2"
                        data-ng-show="stakeholder.filter==='ReportingTo' && stakeholder.Designation!==''">
                        <label class="control-label">Stakeholder/Agency</label>
                        <div class="controls">
                            <select data-ng-model="reportsToStakeholder"
                                data-ui-select2=""
                                class="input-medium"
                                data-ng-change="setPageNumber();getReportsToStakeholders(reportsToStakeholder)">
                                <option></option>
                                <option data-ng-repeat="data in selStakeholder" value="{{data.Id}}">{{data.Name}}</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row-fluid">
                <div class="control-group span2"
                    data-ng-show="stakeholder.filter==='BasedOnWorking'">
                    <label class="control-label">Working for Product</label>
                    <div class="controls">
                        <select data-ng-model="product"
                            data-ui-select2=""
                            class="input-medium"
                            data-ng-change="setPageNumber();getStakeForProduct(product,'product')">
                            <option></option>
                            <option data-ng-repeat="data in productList">{{data}}</option>
                        </select>
                    </div>
                </div>
                <div>
                </div>
            </div>
        </div>
        <div class="form-horizontal row" data-ng-show="showDiv" style="margin-left: 10px; padding-bottom: 10px;">
            <button class="btn  btn-success" data-ng-hide="true">Edit Selected </button>
            <button class="btn  btn-success" data-ng-show="canApprove" data-ng-disabled="Approved || chosenStakeholders.length==0" data-ng-click="approveSelected()">Approve</button>
            <button class="btn  btn-success" data-ng-show="canApprove" data-ng-disabled="Rejected ||Approved ||chosenStakeholders.length==0" data-ng-click="rejected()">Reject</button>
            <button class="btn  btn-success" data-ng-disabled="LeavingDate ||StakeForLeave.StkhWorkings.length==0 || chosenStakeholders.length==0 || chosenStakeholders.length>1" data-ng-click="setLeave()">Leave/Exit</button>
            @* <button class="btn btn-success" data-ng-show="CurrUserInfo.Permission=='Approve'" data-ng-click="addStakeholder()">Add Stakeholder</button>*@

            @*            <button class="btn  btn-success" data-ng-disabled="StakeForLeave.StkhWorkings.length==0 || chosenStakeholders.length==0 || chosenStakeholders.length>1" data-ng-click="setLeave()">Change Working</button>*@
            <div data-ng-show="true">
                <cspagination
                    gotofirstpage="gotoFirstPage()"
                    gotolastpage="gotoLastPage()"
                    stepforward="stepForward()"
                    stepbackward="stepBackward()"
                    currpagenum="pagenum"
                    totalrecords="tolRec"
                    pagesize="size">
               </cspagination>
            </div>
        </div>
        <div class="form-horizontal well " data-ng-show="showDiv" data-ng-repeat="data in stakeholderData">
            @Html.Partial("ViewPartials/ViewBasic")
            @*registration*@
            <div data-ng-show="moreDetails==$index+'RegistrationDetails' && data.StkhRegistrations.length>0">
                <div class="form-horizontal well">
                    @Html.Partial("ViewPartials/ViewRegistration")
                </div>
            </div>
            @*Reportee*@
            <div data-ng-show="moreDetails==$index+'ReporteeDetails' && ReporteeList.length>0">
                <table class="table table-hover table-bordered">
                    <thead>
                        <tr class="info">
                            <th>Name</th>
                            <th>Email Id</th>
                            <th>Date of Joining</th>
                            <th>Payment</th>
                            <th>Working</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr data-ng-repeat="reportee in ReporteeList">
                            <td>{{reportee.Name}}</td>
                            <td>{{reportee.EmailId}}</td>
                            <td>{{reportee.JoiningDate | date}}</td>
                            <td>{{reportee.StkhPayments.length}}</td>
                            <td>{{reportee.StkhWorkings.length}}</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            @Html.Partial("ViewPartials/ViewWorkings")

            @* view Payments*@
            <div data-ng-show="moreDetails==$index+'PaymentDetails' && data.StkhPayments.length>0">
                <table class="table table-hover table-bordered">
                    <thead>
                        <tr>
                            @*<td>Bank Account Number</td>
                            <td>Bank Account Account Name</td>
                            <td>Bank IFSC Code</td>*@
                            <td>Collection Policy</td>
                            <td>Recovery Policy</td>
                            <td>Fixpay  Total</td>
                            <td>Service Charge</td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr data-ng-repeat="payment in data.StkhPayments">
                            @*<td>{{payment.BankAccNo}}</td>
                            <td>{{payment.BankAccName}}</td>
                            <td>{{payment.BankIfscCode}}</td>*@
                            <td>{{payment.VariableLiner}}</td>
                            <td>{{payment.VariableWriteoff}}</td>
                            <td>{{payment.FixpayTotal}}</td>
                            <td>{{payment.ServiceCharge}}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>



    <!--model for edit single stakeholder-->
    <div modal="modelshow" options="modelOption">
        <div class="modal-header">
            Reject List
        </div>
        <div class="modal-body">
            <div class="row-fluid container span12" style="overflow: auto">
                <table class="table table-bordered">
                    <thead class="alert-info">
                        <tr>
                            <td>Name</td>
                            <td>Email ID</td>
                            <td>Date of Joining</td>
                            <td>Date of Birth</td>
                            <td>User Id</td>
                            <td>Mobile Number</td>
                            <td>Gender</td>
                            <td>Reporting Manager</td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr data-ng-repeat="data in chosenStakeholders">
                            <td>{{data.Name}}</td>
                            <td>{{data.EmailId}}</td>
                            <td>{{data.JoiningDate|date:dd-MM-yyyy}}</td>
                            <td>{{data.BirthDate|date:dd-MM-yyyy}}</td>
                            <td>{{data.ExternalId}}</td>
                            <td>{{data.MobileNo}}</td>
                            <td>{{data.Gender}}</td>
                            @*<td>{{getReportingManager(data)}}</td>*@
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="row-fluid">
                <div class="control-group">
                    <label class="control-label">Reject Description</label>
                    <div class="controls">
                        <input type="text" data-ng-model="description" name="Description" data-ng-required="true">
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn" data-dismiss="modal" data-ng-click="closeModel()">Close</button>
            <button class="btn btn-success" data-ng-disabled="!description" data-ng-click="rejectedSelected(description)">Reject</button>
        </div>
    </div>

    <!--modal for set leave of single stakeholder-->
    <div modal="showLeaveModal" options="modelOption" close="closeSetLeave()">
        <div class="modal-header">
            <strong>Change working for stakeholder</strong>
        </div>
        <div class="modal-body">
            @Html.Partial("ViewPartials/ViewOnLeave")
        </div>
        <div class="modal-footer">
            <div class="row-fluid form-horizontal text-right">
                <button class="btn btn-primary" data-ng-click="closeSetLeave()">Close</button>
            </div>
        </div>

    </div>


</div>


@section scripts
{
    <script src="~/Areas/Stakeholder2/ViewModels/ViewStakeholder.js"></script>
}


@* <div class="controls">
                            <label>All</label>
                            <input type="radio" name="filterAdd" value="All" data-ng-model="stakeholder.filter" data-ng-change="getStakeData(stakeholder)" />
                            <label>Active</label>
                            <input type="radio" name="filterAdd" value="Active" data-ng-model="stakeholder.filter" data-ng-change="getStakeData(stakeholder)" />
                            <label>InActive</label>
                            <input type="radio" name="filterAdd" value="InActive" data-ng-model="stakeholder.filter" data-ng-change="getStakeData(stakeholder)" />
                            <label>View Pending Approval</label>
                            <input type="radio" name="filterAdd" value="ViewPending" data-ng-model="stakeholder.filter" data-ng-change="getStakeData(stakeholder)" />
                        </div>*@


@*<div class="panel-footer">
        <div>
            <div class="text-right">
                Page Size:  
                <select class="input-mini" style="margin-top: 10px" >
                    <option>10</option>
                    <option>20</option>
                </select>
                <button class="btn"><i class="icon-step-backward"></i></button>
                <button class="btn"><i class="icon-caret-left icon-large"></i></button>
                <input type="number" value="1" style="margin-top: 10px" class="input-mini text-center">
                <button class="btn"><i class="icon-caret-right icon-large"></i></button>
                <button class="btn"><i class="icon-step-forward"></i></button>
            </div>
        </div>
    </div>*@



@*<div class="control-group span2">
                    <label class="control-label">Pending Approval</label>
                    <div class="controls">
                        <select class="input-small" data-ng-model="stakeholder.filter"
                                data-ui-select2=""
                                data-ng-change="getPendindData(stakeholder.filter)">
                            <option value="PendingForAll">For All</option>
                            <option value="PendingForMe">For Me</option>
                        </select>
                    </div>
                </div>*@