@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div data-ng-controller="payoutPolicyCtrl">

    <div data-ng-form="payoutPolicyForm" class="form-horizontal">
        <div class="row well-small">
            <div class="control-group span5">
                <label class="control-label">Product</label>
                <div class="controls">
                    <select class="input-large" data-ng-model="payoutPolicy.Products" data-ng-change="changeProductCategory()" ui-select2 required>
                        <option value=""></option>
                        <option data-ng-repeat="c in productsList">{{c}}</option>
                    </select>
                </div>
            </div>
            <div class="control-group span6">
                <label class="control-label">Category</label>
                <div class="controls">
                    <csswitch ngbind="payoutPolicy.Category" onbtnclick="changeProductCategory()" namevalues="categorySwitch"></csswitch>
                </div>
            </div>
        </div>
        <div class="row" data-ng-show="false">
            <div class="control-group span5">
                <label class="control-label">Name</label>
                <div class="controls">
                    <input type="text" data-ng-model="payoutPolicy.Name" data-ng-pattern="/^\w*$/" readonly="readonly" required />
                </div>
            </div>
        </div>
    </div>

    <tabset>
         <!--Approved Subpolicy-->
        <tab heading="Approved Subpolicy ( {{(payoutPolicy.BillingRelations | filter:filterRelation(true,'Approved')).length}} )" class="alert-success">
            <table class="table table-bordered form-horizontal" style="border-color: green">
                <tr data-ng-repeat="payoutRelation in payoutPolicy.BillingRelations | filter:filterRelation(true,'Approved') | orderBy: 'Priority'">
                    <td style="border-color: green">
                        <div data-ng-init="disSubPolicy = getDisplaySubPolicy(payoutRelation.BillingSubpolicy)" class="span10">
                            <!--Name-->
                            <div class="row-fluid">
                                <div class="control-group span5">
                                    <label class="control-label">Name</label>
                                    <div class="controls">
                                        <input type="text" data-ng-model="payoutRelation.BillingSubpolicy.Name" readonly="readonly" />
                                    </div>
                                </div>
                            </div>
                            <!--Output & Condition-->
                            <div class="row-fluid">
                                <!--Output-->
                                <div class="control-group span5">
                                    <label class="control-label">Output</label>
                                    <div class="controls">
                                        <textarea class="resize" data-ng-model="disSubPolicy.Output" cols="25" readonly="readonly"></textarea>
                                    </div>
                                </div>
                                <!--condition-->
                                <div class="control-group span6">
                                    <label class="control-label">Condition</label>
                                    <div class="controls">
                                        <textarea class="resize" data-ng-model="disSubPolicy.Condition" cols="25" readonly="readonly"></textarea>
                                    </div>
                                </div>
                            </div>
                            <!--StartDate & EndDate-->
                            <div class="row-fluid">
                                <div class="control-group span5">
                                    <label class="control-label">Start Date</label>
                                    <div class="controls">
                                        <input type="text" readonly value="{{payoutRelation.StartDate|date:'dd-MM-yyyy'}}">
                                    </div>
                                </div>
                                <!--Enddate-->
                                <div class="control-group span6">
                                    <label class="control-label">End Date</label>
                                    <div class="controls">
                                        <input type="text" readonly value="{{payoutRelation.EndDate|date:'dd-MM-yyyy'}}">
                                    </div>
                                </div>
                            </div>
                            <div class="row-fluid">
                                <div class="control-group span4">
                                    <div class="controls btn-group">
                                        <button class="btn btn-danger" data-ng-show="payoutRelation.Status=='Approved'" data-ng-click="openModelDeactivateSubPolicy(payoutRelation)">Deactivate</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row-fluid span2">
                            <div class="row-fluid text-right" style="float: left;">
                                <div class="btn-group btn-group-vertical">
                                    <button class="btn btn-mini icon-arrow-up" data-ng-disabled="$first" data-ng-click="upside(subPolicy,$index)"></button>
                                    <button class="btn btn-mini icon-arrow-down" data-ng-disabled="$last" data-ng-click="downside(subPolicy,$index)"></button>
                                </div>
                                @*<label ng-style="color">Status : {{setStatus(payoutRelation.Status)}}</label>*@
                            </div>
                        </div>
                        
                        <!--Status Div-->
                        <div class="row-fluid span2">
                            <div class="row-fluid" >
                                <div class="row-fluid text-left" >
                                    <label ng-style="color">Status : {{setStatus(payoutRelation.Status)}}</label>
                                </div>
                            </div>
                            <!--CreatedBy-->
                            <div class="row-fluid " >
                                <div class="row-fluid text-left" >
                                    <label style="color:blue">CreatedBy : {{setStatus(payoutRelation.CreatedBy)}}</label>
                                </div>
                            </div>
                            <!--CreatedDate-->
                            <div class="row-fluid " >
                                <div class="row-fluid text-left">
                                    <label style="color:blue">CreatedDate : {{setStatus(payoutRelation.CreatedOn) | date : 'dd-MM-yyyy'}}</label>
                                </div>
                            </div>
                            
                            <!--ApprovedBy-->
                            <div class="row-fluid " >
                                <div class="row-fluid text-left" >
                                    <label style="color:blue">ApprovedBy : {{setStatus(payoutRelation.ApprovedBy)}}</label>
                                </div>
                            </div>
                            <!--ApprovedDate-->
                            <div class="row-fluid " >
                                <div class="row-fluid text-left" >
                                    <label style="color:blue">ApprovedDate : {{setStatus(payoutRelation.ApprovedOn) | date : 'dd-MM-yyyy'}}</label>
                                </div>
                            </div>
                            <!--EffectiveFrom-->
                            <div class="row-fluid " >
                                <div class="row-fluid text-left" >
                                    <label style="color:blue">EffectiveFrom : {{setStatus(payoutRelation.StartDate) | date : 'dd-MM-yyyy'}}</label>
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
            </table>
        </tab>


        <!--UnApproved Subpolicy-->@*Active*@
        <tab heading="UnApproved Subpolicy ( {{(payoutPolicy.BillingRelations | filter:filterRelation(true,'Submitted')).length}} )" class="alert-success">
            <table class="table table-bordered form-horizontal" style="border-color: green">
                <tr data-ng-repeat="payoutRelation in payoutPolicy.BillingRelations | filter:filterRelation(true,'Submitted') | orderBy: 'Priority'">
                    <td style="border-color: green">
                        <div data-ng-init="disSubPolicy = getDisplaySubPolicy(payoutRelation.BillingSubpolicy)" class="span10">
                            <!--Name-->
                            <div class="row-fluid">
                                <div class="control-group span5">
                                    <label class="control-label">Name</label>
                                    <div class="controls">
                                        <input type="text" data-ng-model="payoutRelation.BillingSubpolicy.Name" readonly="readonly" />
                                    </div>
                                </div>
                            </div>
                            <!--Output & Condition-->
                            <div class="row-fluid">
                                <!--Output-->
                                <div class="control-group span5">
                                    <label class="control-label">Output</label>
                                    <div class="controls">
                                        <textarea class="resize" data-ng-model="disSubPolicy.Output" cols="25" readonly="readonly"></textarea>
                                    </div>
                                </div>
                                <!--condition-->
                                <div class="control-group span6">
                                    <label class="control-label">Condition</label>
                                    <div class="controls">
                                        <textarea class="resize" data-ng-model="disSubPolicy.Condition" cols="25" readonly="readonly"></textarea>
                                    </div>
                                </div>
                            </div>
                            <!--StartDate & EndDate-->
                            <div class="row-fluid">
                                <div class="control-group span5">
                                    <label class="control-label">Start Date</label>
                                    <div class="controls">
                                        <input type="text" readonly value="{{payoutRelation.StartDate|date:'dd-MM-yyyy'}}">
                                    </div>
                                </div>
                                <!--Enddate-->
                                <div class="control-group span6">
                                    <label class="control-label">End Date</label>
                                    <div class="controls">
                                        <input type="text" readonly value="{{payoutRelation.EndDate|date:'dd-MM-yyyy'}}">
                                    </div>
                                </div>
                            </div>
                            <div class="row-fluid">
                                <div class="control-group span4">
                                    <div class="controls btn-group">
                                        <button class="btn btn-success" data-ng-show="payoutRelation.Status=='Submitted'" data-ng-click ="payoutRelation.Status='Approved';SaveSubPolicy()">Approve</button>
                                        <button class="btn btn-success" data-ng-show="payoutRelation.Status=='Submitted'" data-ng-click ="payoutRelation.Status='Rejected';RejectSubPolicy(payoutRelation)">Reject</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row-fluid span2">
                            <div class="row-fluid text-right" style="float: left;">
                                <div class="btn-group btn-group-vertical">
                                    <button class="btn btn-mini icon-arrow-up" data-ng-disabled="$first" data-ng-click="upside(subPolicy,$index)"></button>
                                    <button class="btn btn-mini icon-arrow-down" data-ng-disabled="$last" data-ng-click="downside(subPolicy,$index)"></button>
                                </div>
                                @*<label ng-style="color">Status : {{setStatus(payoutRelation.Status)}}</label>*@
                            </div>
                        </div>
                        
                        <!--Status Div-->
                        <div class="row-fluid span2">
                            <div class="row-fluid" >
                                <div class="row-fluid text-left" >
                                    <label ng-style="color">Status : {{setStatus(payoutRelation.Status)}}</label>
                                </div>
                            </div>
                            <!--CreatedBy-->
                            <div class="row-fluid " >
                                <div class="row-fluid text-left" >
                                    <label style="color:blue">CreatedBy : {{setStatus(payoutRelation.CreatedBy)}}</label>
                                </div>
                            </div>
                            <!--CreatedDate-->
                            <div class="row-fluid " >
                                <div class="row-fluid text-left">
                                    <label style="color:blue">CreatedDate : {{setStatus(payoutRelation.CreatedOn) | date : 'dd-MM-yyyy'}}</label>
                                </div>
                            </div>
                            
                            <!--ApprovedBy-->
                            <div class="row-fluid " >
                                <div class="row-fluid text-left" >
                                    <label style="color:blue">ApprovedBy : {{setStatus(payoutRelation.ApprovedBy)}}</label>
                                </div>
                            </div>
                            <!--ApprovedDate-->
                            <div class="row-fluid " >
                                <div class="row-fluid text-left" >
                                    <label style="color:blue">ApprovedDate : {{setStatus(payoutRelation.ApprovedOn) | date : 'dd-MM-yyyy'}}</label>
                                </div>
                            </div>
                            <!--EffectiveFrom-->
                            <div class="row-fluid " >
                                <div class="row-fluid text-left" >
                                    <label style="color:blue">EffectiveFrom : {{setStatus(payoutRelation.StartDate) | date : 'dd-MM-yyyy'}}</label>
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
            </table>
        </tab>
        <!--Expired Subpolicy-->@*Old*@
        <tab heading="Expired Subpolicy ( {{(payoutPolicy.BillingRelations | filter:filterRelation(false,'')).length}} )" class="alert-error">
            <table class="table table-bordered form-horizontal" style="border-color: red">
                <tr data-ng-repeat="billingRelation in payoutPolicy.BillingRelations | filter:filterRelation(false,'')">
                    <td style="border-color: red">
                        <div data-ng-init="disSubPolicy = getDisplaySubPolicy(billingRelation.BillingSubpolicy)" class="span10">
                            <div class="row-fluid">
                                <div class="control-group span5">
                                    <label class="control-label">Name</label>
                                    <div class="controls">
                                        <input type="text" data-ng-model="billingRelation.BillingSubpolicy.Name" readonly="readonly" />
                                    </div>
                                </div>
                            </div>
                            <!--Output & Condition-->
                            <div class="row-fluid">
                                <!--Output-->
                                <div class="control-group span5">
                                    <label class="control-label">Output</label>
                                    <div class="controls">
                                        <textarea class="resize" data-ng-model="disSubPolicy.Output" cols="25" readonly="readonly"></textarea>
                                    </div>
                                </div>
                                <!--Condition-->
                                <div class="control-group span6">
                                    <label class="control-label">Condition</label>
                                    <div class="controls">
                                        <textarea class="resize" data-ng-model="disSubPolicy.Condition" cols="25" readonly="readonly"></textarea>
                                    </div>
                                </div>
                            </div>
                            <!--StartDate & EndDate-->
                            <div class="row-fluid">
                                <div class="control-group span5">
                                    <label class="control-label">Start Date</label>
                                    <div class="controls">
                                        <input type="text" readonly value="{{billingRelation.StartDate|date:'dd-MM-yyyy'}}">
                                    </div>
                                </div>
                                <div class="control-group span6">
                                    <label class="control-label">End Date</label>
                                    <div class="controls">
                                        <input type="text" readonly value="{{billingRelation.EndDate|date:'dd-MM-yyyy'}}">
                                    </div>
                                </div>
                            </div>
                      
                        <!--Button-->
                        <div class="row-fluid">
                            <div class="control-group span4">
                                <div class="controls btn-group">
                                    <button class="btn btn-primary" data-ng-click="openModel(billingRelation,true)">ReActivate</button>
                                </div>
                            </div>
                        </div>
                     </div>

                   <div class="row-fluid span2">
                       <div class="row-fluid text-right" style="float: left;">
                           <div class="btn-group btn-group-vertical">
                               <button class="btn btn-mini icon-arrow-up" data-ng-disabled="$first" data-ng-click="upside(subPolicy,$index)"></button>
                               <button class="btn btn-mini icon-arrow-down" data-ng-disabled="$last" data-ng-click="downside(subPolicy,$index)"></button>
                           </div>
                       </div>
                   </div>
    
    <!--Status Div-->
    <div class="row-fluid span2">
        <div class="row-fluid">
            <div class="row-fluid text-left">
                <label ng-style="color">Status : {{setStatus(billingRelation.Status)}}</label>
            </div>
        </div>
        <!--CreatedBy-->
        <div class="row-fluid ">
            <div class="row-fluid text-left">
                <label style="color: red">CreatedBy : {{setStatus(billingRelation.CreatedBy)}}</label>
            </div>
        </div>
        <!--CreatedDate-->
        <div class="row-fluid ">
            <div class="row-fluid text-left">
                <label style="color: red">CreatedDate : {{setStatus(billingRelation.CreatedOn) | date : 'dd-MM-yyyy'}}</label>
            </div>
        </div>
    
        <!--ApprovedBy-->
        <div class="row-fluid ">
            <div class="row-fluid text-left">
                <label style="color: red">ApprovedBy : {{setStatus(billingRelation.ApprovedBy)}}</label>
            </div>
        </div>
        <!--ApprovedDate-->
        <div class="row-fluid ">
            <div class="row-fluid text-left">
                <label style="color: red">ApprovedDate : {{setStatus(billingRelation.ApprovedOn) | date : 'dd-MM-yyyy'}}</label>
            </div>
        </div>
        <!--EffectiveFrom-->
        <div class="row-fluid ">
            <div class="row-fluid text-left">
                <label style="color: red">EffectiveFrom : {{setStatus(billingRelation.StartDate) | date : 'dd-MM-yyyy'}}</label>
            </div>
        </div>
    </div>
    </td>
                    </tr>
                </table>
            </tab>
            <!--Draft SubPolicy-->@*New*@
    <tab heading="Draft SubPolicy ( {{subPolicyList.length}} )" class="alert-info">
                <table class="table table-bordered form-horizontal" style="border-color: blue">
                    <tr data-ng-repeat="subPolicy in subPolicyList">
                        <td style="border-color: blue">
                            <div data-ng-init="disSubPolicy = getDisplaySubPolicy(subPolicy)" class="span10">
                                <div class="row">
                                    <div class="control-group span5">
                                        <label class="control-label">Name</label>
                                        <div class="controls">
                                            <input type="text" data-ng-model="subPolicy.Name" readonly="readonly" />
                                        </div>
                                    </div> 
                                </div>
                                <div class="row">
                                    <div class="control-group span5">
                                        <label class="control-label">Output</label>
                                        <div class="controls">
                                            <textarea data-ng-model="disSubPolicy.Output" cols="25" readonly="readonly"></textarea>
                                        </div>
                                    </div>
    
                                    <div class="control-group span6">
                                        <label class="control-label">Condition</label>
                                        <div class="controls">
                                            <textarea data-ng-model="disSubPolicy.Condition" cols="25" readonly="readonly"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        
                            <div class="span2">
                                <div class="btn-group">
                                    <button class="btn btn-primary" data-ng-click="openModelNewSubPolicy(subPolicy,$index)">Activate</button>
                                </div>
                            </div>
                                    
                        </td>
                    </tr>
                </table>
            </tab>
    </tabset>

    <div modal="openDateModel">
        <div class="form-horizontal" data-ng-form="payoutpolicyDateRangeForm">
            <div class="modal-header well" style="text-align: center">
                <h3>{{modalData.PayoutRelation.BillingSubpolicy.Name}}</h3>
            </div>
            <div class="modal-body" style="text-align: center">
                <div class="control-group">
                    <label class="control-label">Start Date</label>
                    <div class="controls">
                        <div class="input-append">
                            @*<input class="input-medium" type="text" name="ScheduleDate" data-ng-model="modalData.startDate" data-bs-datepicker="">*@
                            <input class="input-medium" data-ng-disabled="!modalData.forActivate" type="text" name="ScheduleDate" data-ng-model="modalData.startDate" required
                                data-date-start-date="+1d" data-ng-readonly="true" data-bs-datepicker="" data-ng-change="modalData.endDate=null;modelDateValidation(modalData.startDate,modalData.endDate)">
                            <button type="button" class="btn" data-toggle="datepicker"><i class="icon-calendar"></i></button>
                        </div>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label">End Date</label>
                    <div class="controls">
                        <div class="input-append">
                            @*<input class="input-medium" type="text" name="ScheduleDate" data-ng-model="modalData.endDate" data-bs-datepicker="">*@
                            <input class="input-medium" type="text" name="ScheduleDate" data-ng-model="modalData.endDate" data-ng-change="modelDateValidation(modalData.startDate,modalData.endDate)"
                                data-date-start-date="+1d" data-ng-readonly="true"
                                data-bs-datepicker="">
                            <button type="button" class="btn" data-toggle="datepicker"><i class="icon-calendar"></i></button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer well">
                <button class="btn btn-danger" data-ng-show="!modalData.forActivate" data-ng-disabled="payoutpolicyDateRangeForm.$invalid" data-ng-click="deactivateSubPoicy(modalData)">Deactivate</button>
                <button class="btn btn-primary" data-ng-show="modalData.forActivate" data-ng-disabled="!(payoutpolicyDateRangeForm.$valid && isModalDateValid)" data-ng-click="activateSubPoicy(modalData)">Activate</button>
                <button class="btn btn-warning" data-ng-click="closeModel()">Cancel</button>
            </div>
        </div>
    </div>

</div>

@section scripts
    {
    <script src="~/Areas/Billing/ViewModels/payoutPolicyCtrl.js"></script>
}


@* <div data-ng-show="payoutPolicy.BillingRelations.length" class="modal-footer">
        <button class="btn btn-success" data-ng-click="savePayoutPolicy(payoutPolicy)">Save</button>
        <button class="btn btn-warning" data-ng-click="reset()">Reset</button>
    </div>*@