@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="row-fluid" data-ng-controller="BillAmountCntrl">
    <div class="panel form-horizontal">
        <div class="panel-heading">
            <label><b>Bill Summary</b></label>
        </div>
        <div class="row-fluid">
            <div class="control-group span3">
                <div class="control-label">
                    <label>Product</label>
                </div>
                <div class="controls">
                    <select class="input-medium"
                        data-ng-model="BillAmount.Product"
                        data-ng-change="getStakeholders(BillAmount.Product)"
                        data-ui-select2="">
                        <option></option>
                        <option data-ng-repeat="data in products">{{data}}</option>
                    </select>
                </div>
            </div>
            <div data-ng-show="BillAmount.Product" class="control-group span3">
                <div class="control-label">
                    <label>Stakeholder</label>
                </div>
                <div class="controls">
                    <select class="input-large"
                        data-ng-model="BillAmount.Stakeholder"
                        data-ui-select2=""
                        data-ng-change="getBillingData(BillAmount.Product,BillAmount.Stakeholder,BillAmount.Month)">
                        <option></option>
                        <option value="{{data.Id}}" data-ng-repeat="data in stakeholderList">{{data.Name}}</option>
                    </select>
                </div>
            </div>
            <div data-ng-show="BillAmount.Stakeholder" class="control-group span4 ">
                <div class="control-label">
                    <label>Month</label>
                </div>
                <div class="controls">
                    <div class="input-append">
                        <input class="input-medium" type="text" name="StartMonth" data-ng-model="BillAmount.Month"
                            data-ng-change="getBillingData(BillAmount.Product,BillAmount.Stakeholder,BillAmount.Month)"
                            data-date-days-of-week-disabled="'0'" data-date-min-view-mode="1" data-date-format="yyyy-MM-dd"
                            data-bs-datepicker="" />
                        <button type="button" class="btn" data-toggle="datepicker"><i class="icon-calendar"></i></button>
                    </div>
                </div>
            </div>
        </div>
        <hr>
        <div>
            <div class="text-center">
                <div class="row-fluid">
                    <div class="control-group span5 text-left">
                        <div class="control-label">
                            <label>Fixed Amount</label>
                        </div>
                        <div class="controls">
                            <div class="input-append">
                                <input type="text" data-ng-model="billingData.FixedAmount" readonly />
                                @* <button
                                    data-ng-disabled="enableLink()"
                                    class="btn btn-link"
                                    data-ng-click="getDetailData(BillAmount.Stakeholder,BillAmount.Month);viewPopUp=!viewPopUp">
                                    View Details</button>*@
                            </div>
                        </div>
                    </div>
                    <div class="control-group span5">
                        <div class="control-label">
                            <label>Start Date</label>
                        </div>
                        <div class="controls">
                            <input type="text" value="{{billingData.StartDate | date:'yyyy-MM-dd'}}" readonly />
                        </div>
                    </div>

                </div>
                <div class="row-fluid">
                    <div class="control-group span5">
                        <div class="control-label">
                            <label>Variable Amount</label>
                        </div>
                        <div class="controls">
                            <div class="input-append">
                                <input type="text" data-ng-model="billingData.VariableAmount" readonly>
                                <button
                                    data-ng-disabled="enableLink()"
                                    data-ng-click="getDetailData('Variable');viewPopUp=!viewPopUp"
                                    class="btn btn-link">
                                    View Details</button>
                            </div>
                        </div>
                    </div>
                    <div class="control-group span5">
                        <div class="control-label">
                            <label>End Date</label>
                        </div>
                        <div class="controls">
                            <input type="text" value="{{billingData.EndDate}}" readonly />
                        </div>
                    </div>
                </div>
                <div class="row-fluid">
                    <div class="control-group span5">
                        <div class="control-label">
                            <label>Deduction/Incentive</label>
                        </div>
                        <div class="controls">
                            <div class="input-append">
                                <input type="text" data-ng-model="billingData.Deductions" readonly />
                                <button
                                    data-ng-disabled="enableLink()"
                                    data-ng-click="getDetailData('Adhoc');viewPopUp=!viewPopUp"
                                    class="btn btn-link">
                                    View Details</button>
                                <button
                                    data-ng-click="AddPopUp=!AddPopUp"
                                    data-ng-disabled="enableLink()"
                                    class="btn btn-link">
                                    Add New</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row-fluid" data-ng-show="false">
                    <div class="control-group span3">
                        <div class="control-label">
                            <label>Tax Amount</label>
                        </div>
                        <div class="controls">
                            <div class="input-append">
                                <input type="text" data-ng-model="billingData.TaxAmount" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <br>
            <div class="row-fluid text-center">
                <button class="btn btn-success"
                    data-ng-show="!enableLink()"
                    data-ng-click="approvePayBillingAmount(billingData,'Approve')"
                    data-ng-disabled="billingData.Status==='Approved'">
                    Approve</button>

                <button class="btn btn-success"
                    data-ng-click="approvePayBillingAmount(billingData,'Pay')"
                    data-ng-show="billingData.Status==='Approved'"
                    data-ng-disabled="billingData.PayStatus =='Paid'">
                    Paid</button>
                <div></div>
            </div>
        </div>
    </div>
    <div modal="viewPopUp" options="modelOption">
        <div class="modal-header">
            <strong>Details</strong>
        </div>
        <div class="modal-body">
            <table class="table table-bordered table-hover">
                <thead>
                    <tr>
                        <th>Billing Policy</th>
                        <th>Billing Subpolicy</th>
                        <th>Amount</th>
                    </tr>
                </thead>
                <tbody>
                    <tr data-ng-repeat="data in moreDetails">
                        <td>{{data.BillingPolicy.Name}}</td>
                        <td>{{data.BillingSubpolicy.Name}}</td>
                        <td>{{data.Amount}}</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="modal-footer">
            <div class="text-right">
                <button class="btn btn-success" data-ng-click="viewPopUp=false">Close</button>
            </div>
        </div>
    </div>
    <div modal="AddPopUp" options="modelOption">
        <div class="modal-header">
            <strong>Payout Details</strong>
        </div>
        <div class="modal-body">
            <div class="form-horizontal well">
                <form name="adhocPayoutform">
                    <div class="row-fluid">
                        <div class="control-group span5">
                            <label class="control-label">Total Amount</label>
                            <div class="controls">
                                <input type="text" data-ng-model="adhocPayout.TotalAmount" name="totalamount" data-ng-pattern="/^[0-9]+$/" required />
                                <!--Total Amount Validation-->
                                <div data-ng-show="adhocPayoutform.totalamount.$dirty && adhocPayoutform.totalamount.$invalid">
                                    <div class="field-validation-error" data-ng-show="adhocPayoutform.totalamount.$error.required">{{val.Required()}}</div>
                                    <div class="field-validation-error" data-ng-show="adhocPayoutform.totalamount.$error.pattern">{{val.OnlyNumbers()}}</div>
                                </div>
                            </div>
                        </div>
                        <div class="control-group span5">
                            <label class="control-label">Transcation Type</label>
                            <div class="controls">
                                <select class="input-large" data-ng-model="adhocPayout.IsCredit" name="TranscationType" ui-select2
                                    data-ng-change="selectTransaction(adhocPayout.IsCredit)" required>
                                    <option value=""></option>
                                    <option data-ng-repeat="type in transcationTypes" value="{{type.value}}">{{type.display}}</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row-fluid">
                        <div class="control-group span5">
                            <label class="control-label">Reasons</label>
                            <div class="controls">
                                <select class="input-large" data-ng-model="adhocPayout.ReasonCode" ui-select2 required>
                                    <option value=""></option>
                                    <option data-ng-repeat="reason in reasonCode">{{reason.display}}</option>
                                </select>
                            </div>
                        </div>
                         <div class="control-group" data-ng-show="false">
                            <label class="control-label">Tax</label>
                            <div class="controls">
                                <select class="input-large" data-ng-model="adhocPayout.IsPretax" ui-select2>
                                    <option value=""></option>
                                    <option data-ng-repeat="t in taxtype">{{t}}</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row-fluid">
                        <div class="control-group">
                            <label class="control-label">Description</label>
                            <div class="controls">
                                <textarea class="resize" data-ng-model="adhocPayout.Description" style="width: 690px" required></textarea>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <div class="modal-footer">
            <div class="text-right">
                <button class="btn btn-success"
                    data-ng-disabled="adhocPayoutform.$invalid"
                    data-ng-click="addAdhocPayout(adhocPayout,billingData);AddPopUp=false">
                    Add</button>
                <button class="btn btn-success" data-ng-click="AddPopUp=false">Close</button>
            </div>
        </div>
    </div>
</div>



@section scripts
{
    <script src="~/Areas/Billing/ViewModels/BillAmountCntrl.js"></script>
}
